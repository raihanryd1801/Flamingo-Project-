<?php
 goto MX2TO; gv1g6: foreach ($routers as $router) { $API = new RouterosAPI(); $API->debug = false; $portsToTry = isset($router["\x70\x6f\x72\x74"]) ? array($router["\x70\x6f\x72\164"]) : array(8728, 8729); $connected = false; foreach ($portsToTry as $port) { if ($API->connect($router["\x69\x70"], $router["\x75\x73\x65\162"], $router["\x70\x61\x73\163"], $port)) { echo "\x3f\40\x52\157\x75\x74\145\x72\40{$router["\151\160"]}\x20\x74\145\162\153\157\x6e\145\x6b\163\x69\40\x64\x69\40\160\157\x72\x74\40{$port}\12"; $connected = true; break; } } if (!$connected) { $error = "\77\x20\x53\x65\x6d\x75\x61\40\x70\x6f\162\164\x20\147\141\147\x61\x6c\x20\x6b\157\156\145\x6b\40\153\145\40\x72\157\165\x74\145\x72\40{$router["\x69\x70"]}\40\160\141\x64\x61\x20" . date("\131\x2d\155\x2d\144\40\110\x3a\x69\x3a\x73") . "\12"; file_put_contents($logFile, $error, FILE_APPEND); echo $error; continue; } $ppp_active = $API->comm("\x2f\x70\x70\160\57\x61\x63\164\151\x76\145\57\160\162\151\x6e\164"); $ppp_secret = $API->comm("\x2f\160\160\160\x2f\x73\x65\143\162\145\164\57\160\162\151\x6e\x74"); $active_map = array(); foreach ($ppp_active as $ppp) { $active_map[$ppp["\x6e\x61\x6d\145"]] = array("\x69\x70" => $ppp["\141\x64\x64\x72\x65\x73\163"], "\165\x70\164\x69\x6d\x65" => $ppp["\165\160\x74\151\155\145"]); } $current_users = array(); foreach ($ppp_secret as $secret) { $username = $secret["\x6e\x61\x6d\145"]; $comment = $secret["\x63\x6f\155\x6d\x65\x6e\x74"] ?? "\x2d"; $password = $secret["\x70\x61\x73\163\x77\x6f\x72\x64"] ?? "\55"; $is_active = isset($active_map[$username]); $status = $is_active ? "\141\x6b\x74\x69\146" : "\x74\x69\x64\x61\153\40\x61\153\164\151\x66"; $ip = $is_active ? $active_map[$username]["\x69\x70"] : null; $uptime = $is_active ? $active_map[$username]["\x75\x70\x74\151\155\145"] : null; $last_update = date("\131\x2d\155\55\x64\x20\110\x3a\x69\72\x73"); $router_id = $router["\151\x64"]; $current_users[] = $username; $sql = "\xa\40\40\40\x20\x20\40\40\40\x20\x20\x20\40\111\116\123\x45\x52\124\40\111\116\124\117\40\x70\145\x6c\141\156\x67\x67\x61\x6e\40\50\165\x73\x65\162\156\x61\155\145\x2c\40\x63\x6f\155\x6d\x65\156\x74\54\x20\160\141\x73\x73\x77\157\x72\144\x2c\x20\x73\164\141\164\165\163\54\x20\x6c\x61\163\x74\137\163\164\x61\164\x75\163\54\x20\x69\x70\137\x61\x64\144\x72\145\163\163\54\40\x75\x70\x74\151\155\x65\x2c\40\x6c\141\x73\x74\x5f\165\160\144\x61\164\x65\x2c\x20\x72\x6f\165\164\145\x72\137\x69\144\x29\12\40\x20\x20\x20\x20\40\x20\x20\40\x20\x20\40\x56\101\114\125\105\123\40\x28\77\54\40\77\x2c\40\x3f\54\x20\77\x2c\x20\77\54\40\x3f\x2c\x20\x3f\54\x20\x3f\x2c\x20\77\51\12\40\40\x20\40\x20\40\40\40\x20\40\40\x20\117\x4e\x20\x44\125\x50\x4c\111\103\x41\124\x45\40\113\x45\x59\x20\x55\120\x44\x41\x54\105\xa\40\x20\40\x20\40\x20\40\x20\40\40\40\40\40\40\40\40\143\x6f\x6d\155\145\x6e\x74\x20\75\40\x56\101\x4c\125\x45\123\x28\x63\x6f\x6d\155\145\156\x74\51\x2c\xa\x20\40\x20\x20\40\40\x20\x20\40\40\x20\x20\40\x20\40\40\x70\141\163\x73\167\157\162\x64\40\75\x20\x56\101\114\125\x45\x53\50\x70\141\163\163\x77\157\x72\x64\51\54\xa\x20\40\40\x20\40\x20\40\x20\40\x20\40\40\x20\40\x20\x20\154\141\x73\164\137\x73\164\141\x74\x75\163\40\x3d\40\x73\164\141\164\x75\x73\x2c\xa\x20\x20\x20\x20\x20\40\40\x20\40\x20\x20\x20\x20\x20\x20\40\x73\164\141\x74\165\x73\x20\75\x20\126\101\114\x55\x45\123\x28\163\x74\x61\164\x75\163\x29\x2c\xa\x20\x20\x20\40\x20\x20\40\40\40\40\x20\40\x20\x20\40\40\151\x70\137\141\x64\144\162\145\163\x73\40\75\x20\126\x41\x4c\x55\x45\x53\50\151\160\x5f\x61\x64\x64\x72\x65\163\x73\x29\54\xa\40\x20\40\x20\x20\x20\40\40\40\40\x20\x20\x20\x20\x20\40\165\x70\164\151\155\145\x20\x3d\40\x56\101\114\125\x45\123\x28\x75\x70\164\151\155\145\x29\x2c\12\40\40\40\x20\40\x20\40\x20\x20\x20\40\40\40\x20\x20\x20\154\x61\163\164\137\165\160\x64\141\164\145\x20\x3d\x20\126\x41\x4c\125\105\123\x28\154\x61\x73\x74\x5f\165\160\x64\x61\164\145\51\12\x20\40\x20\x20\40\x20\x20\40"; $stmt = $koneksi->prepare($sql); if (!$stmt) { $errMsg = "\77\x20\120\162\x65\160\x61\x72\x65\x20\x66\141\x69\x6c\x65\x64\40\x28\x52\157\x75\x74\145\162\40{$router["\x69\x70"]}\x29\72\40" . $koneksi->error . "\12"; file_put_contents($logFile, $errMsg, FILE_APPEND); continue; } $stmt->bind_param("\x73\163\163\x73\163\163\x73\163\x69", $username, $comment, $password, $status, $status, $ip, $uptime, $last_update, $router_id); if (!$stmt->execute()) { file_put_contents($logFile, "\x3f\40\105\x78\x65\143\165\x74\x65\x20\x66\x61\x69\x6c\145\144\x20\x28\122\157\x75\x74\145\162\x20{$router["\151\160"]}\x29\72\40" . $stmt->error . "\12", FILE_APPEND); } $stmt->close(); } if (!empty($current_users)) { $placeholders = implode("\54", array_fill(0, count($current_users), "\77")); $sql_delete = "\104\x45\114\105\x54\x45\x20\106\x52\x4f\115\40\160\x65\x6c\141\x6e\147\147\x61\156\x20\127\x48\105\122\x45\40\162\x6f\165\164\x65\x72\x5f\x69\x64\40\x3d\40\77\40\x41\x4e\x44\x20\165\163\145\162\156\x61\x6d\x65\40\116\x4f\x54\40\x49\116\40\x28{$placeholders}\x29"; $stmt_del = $koneksi->prepare($sql_delete); if ($stmt_del) { $types = "\x69" . str_repeat("\163", count($current_users)); $params = array_merge(array($router["\151\144"]), $current_users); $stmt_del->bind_param($types, ...$params); $stmt_del->execute(); $stmt_del->close(); } } else { $koneksi->query("\x44\105\x4c\x45\x54\105\40\x46\122\117\x4d\40\x70\x65\154\141\156\x67\x67\141\156\40\x57\x48\x45\x52\x45\x20\x72\157\x75\164\x65\162\x5f\151\144\40\x3d\40{$router["\151\144"]}"); } $API->disconnect(); echo "\77\40\x53\171\156\x63\40\x72\x6f\x75\164\145\162\x20{$router["\151\160"]}\x20\x73\145\x6c\145\163\141\x69\12"; } goto FfTMx; Spjc6: $now = time(); goto IWL2M; IB5Nw: error_reporting(E_ALL); goto YZZD1; Ui4tJ: $logFile = __DIR__ . "\x2f\56\x2e\x2f\154\x6f\147\163\x2f\x73\x79\156\x63\56\x6c\157\147"; goto tfyCu; MX2TO: ini_set("\x64\x69\x73\x70\x6c\x61\171\137\145\x72\162\157\162\x73", 1); goto IB5Nw; FfTMx: file_put_contents($logFile, "\x3f\x20\123\x79\156\x63\72\x20" . date("\x59\55\x6d\55\x64\x20\x48\x3a\151\x3a\163") . "\xa", FILE_APPEND); goto HzTi0; tgTeB: $routers = array(array("\151\144" => 1, "\151\160" => "\x31\60\x33\56\61\64\x38\56\61\x39\x36\x2e\61\63\60", "\165\x73\145\162" => "\x6e\157\143\x40\x61\x71\x73\x61\141\x2e\x69\x64", "\x70\141\163\163" => "\x6e\157\143\100\141\x71\163\x61\x61\x2e\151\144"), array("\151\144" => 2, "\151\160" => "\x31\x30\63\x2e\61\x34\70\x2e\x31\71\x37\x2e\61\x34", "\x75\x73\145\162" => "\x6e\x6f\143\x40\x61\161\163\141\x61\x2e\x69\144", "\x70\141\163\163" => "\156\x6f\x63\x40\x61\161\x73\141\x61\x2e\151\144"), array("\x69\x64" => 3, "\x69\160" => "\x31\x30\x33\x2e\x31\64\70\56\61\71\66\56\61\64", "\x75\163\x65\x72" => "\156\x6f\143\x40\141\161\x73\x61\x61\x2e\151\144", "\160\x61\163\x73" => "\x6e\x6f\x63\100\x61\x71\163\141\x61\x2e\151\x64"), array("\151\x64" => 4, "\x69\160" => "\61\60\x33\x2e\x31\64\70\x2e\x31\71\x36\x2e\61\63\71", "\165\163\x65\162" => "\x6e\157\x63\x40\x61\161\163\x61\141\56\151\x64", "\160\141\x73\x73" => "\156\157\143\100\141\x71\x73\141\141\x2e\151\144"), array("\151\x64" => 5, "\x69\x70" => "\x31\x30\63\x2e\x31\x34\x38\x2e\x31\x39\67\56\61\61\63", "\165\x73\145\x72" => "\110\x65\162\144\171", "\x70\141\x73\x73" => "\122\x6f\163\167\x61\x74\171\71\x30\x39", "\160\x6f\x72\x74" => 7729), array("\x69\144" => 6, "\151\160" => "\61\x30\63\x2e\61\x34\70\x2e\x31\71\x36\56\61\65\64", "\x75\x73\145\x72" => "\156\x6f\x63\x40\141\x71\x73\x61\141\56\151\x64", "\160\x61\163\163" => "\156\x6f\143\x40\x61\x71\x73\x61\x61\x2e\151\144")); goto gv1g6; yAvuS: require_once "\57\166\x61\x72\57\x77\167\167\x2f\x68\x74\x6d\x6c\57\155\157\x6e\x69\164\157\162\x69\156\147\x2f\162\x6f\165\x74\x65\162\x6f\163\x2d\141\x70\x69\x2f\x72\157\165\164\x65\162\x6f\163\137\x61\160\151\56\x63\x6c\x61\x73\x73\x2e\x70\150\x70"; goto Ui4tJ; YZZD1: require_once "\x2f\166\x61\162\57\167\x77\x77\57\x68\x74\155\x6c\x2f\155\x6f\156\151\x74\157\162\x69\x6e\147\57\143\x6f\x6e\x66\151\147\57\x64\142\x2e\160\x68\x70"; goto yAvuS; HzTi0: echo "\x3f\40\123\x65\155\165\x61\x20\163\171\156\x63\x20\163\145\x6c\145\163\141\151\40\x70\x61\x64\x61\x20" . date("\x59\55\x6d\x2d\144\x20\110\x3a\151\72\163") . "\xa"; goto sxwY_; tfyCu: $lastSync = file_exists($logFile) ? filemtime($logFile) : 0; goto Spjc6; IWL2M: if ($now - $lastSync < 10) { echo "\x3f\x20\x53\x6b\x69\x70\72\x20\123\171\x6e\143\40\x74\145\162\154\x61\154\x75\x20\143\x65\x70\141\164\x2e\12"; die; } goto tgTeB; sxwY_: ?>
